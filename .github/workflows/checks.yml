name: Checks

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Fetch the full history instead of a shallow clone
      - uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Install buf
        run: |
          curl -sSL https://github.com/bufbuild/buf/releases/download/v1.47.2/buf-Linux-x86_64 -o /usr/local/bin/buf
          chmod +x /usr/local/bin/buf
          buf --version
      - name: Authenticate buf
        run: echo $BUF_TOKEN | buf registry login --token-stdin
        env:
          BUF_TOKEN: ${{ secrets.BUF_TOKEN }}
      - run: yarn
      - run: yarn lint:all
      - run: yarn build:all
      - run: yarn test:all
